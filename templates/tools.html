{% extends "base.html" %}

{% block title %}CRX Tools - DOHMBDY64{% endblock %}

{% block styles %}
<link href="{{ url_for('static', filename='css/tools.css') }}" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
{% endblock %}

{% block head_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify-css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify-html.min.js"></script>
{% endblock %}

{% block content %}
<div class="text-center space-y-6">
    <h1 class="text-2xl md:text-4xl text-orange-500 mb-8">CRX DOWNLOADER</h1>
    <p class="text-sm md:text-base text-gray-300 max-w-2xl mx-auto leading-relaxed">
        Download Chrome Extensions as CRX or ZIP files
    </p>
</div>

<form id="crx-form" class="w-full max-w-2xl space-y-8 text-center">
    <div class="space-y-4">
        <input type="text" id="extension-id" name="extension_id" 
               placeholder="Paste Chrome Web Store URL" 
               class="retro-input" required>
        
        <div class="flex justify-center gap-8">
            <label class="flex items-center cursor-pointer">
                <input type="radio" name="format" value="crx" 
                       class="retro-radio" checked>
                <span>CRX Format</span>
            </label>
            <label class="flex items-center cursor-pointer">
                <input type="radio" name="format" value="zip" 
                       class="retro-radio">
                <span>ZIP Format</span>
            </label>
        </div>
    </div>

    <div class="flex justify-center gap-4">
        <button type="submit" class="retro-button">DOWNLOAD</button>
        <button type="button" class="retro-button" id="view-button">VIEW</button>
    </div>
    <p id="error-message" class="error-message">Error downloading extension</p>
</form>

<!-- Source Code Viewer Modal -->
<div id="source-viewer-modal" class="fixed inset-0 hidden bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
    <div class="bg-gray-900 border-4 border-orange-500 rounded-lg w-11/12 h-[90vh] max-w-6xl flex flex-col">
        <div class="flex justify-between items-center p-4 border-b border-orange-500">
            <div class="flex items-center gap-4">
                <h2 class="text-xl text-orange-500">SOURCE CODE VIEWER</h2>
                <select id="file-selector" class="retro-input bg-gray-800 text-gray-300 px-4 py-2 rounded">
                    <option value="manifest.json">manifest.json</option>
                </select>
            </div>
            <button id="close-modal" class="retro-button px-4">CLOSE</button>
        </div>
        <div class="flex-1 overflow-hidden">
            <div id="code-container" class="h-full overflow-auto p-4">
                <div id="loading-indicator" class="hidden text-center p-4">
                    <div class="text-orange-500 text-xl animate-pulse">LOADING...</div>
                </div>
                <pre id="source-code" class="line-numbers h-full"><code class="language-json"></code></pre>
                <div id="load-more" class="hidden text-center mt-4">
                    <button class="retro-button">LOAD MORE</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="text-center space-y-6 mt-12">
    <h2 class="text-xl text-orange-500">How to find Extension ID?</h2>
    <p class="text-sm text-gray-300 max-w-2xl mx-auto leading-relaxed">
        1. Go to Chrome Web Store extension page<br>
        2. Copy the FULL URL or Extension ID<br>
        3. Paste the entire URL or ID - the system will extract the ID automatically
    </p>
</div>
{% endblock %}

{% block scripts %}
<!-- Utility Functions -->
<script src="{{ url_for('static', filename='js/utils/fileUtils.js') }}"></script>
<script src="{{ url_for('static', filename='js/utils/mimeTypes.js') }}"></script>

<!-- CRX Processing -->
<script src="{{ url_for('static', filename='js/crx/validator.js') }}"></script>
<script src="{{ url_for('static', filename='js/crx/converter.js') }}"></script>
<script src="{{ url_for('static', filename='js/crx/downloader.js') }}"></script>

<!-- UI Components -->
<script src="{{ url_for('static', filename='js/ui/fileList.js') }}"></script>
<script src="{{ url_for('static', filename='js/ui/sourceViewer.js') }}"></script>

<!-- Page Script -->
<script src="{{ url_for('static', filename='js/tools.js') }}"></script>
{% endblock %} 