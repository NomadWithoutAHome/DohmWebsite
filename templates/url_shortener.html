{% extends "base.html" %}

{% block title %}URL Shortener - DOHMBDY64{% endblock %}

{% block styles %}
<style>
    .url-form {
        max-width: 800px;
        margin: 0 auto;
    }

    .url-input {
        width: 100%;
        padding: 1rem;
        margin-bottom: 1rem;
        background: #1a1a1a;
        border: 2px solid #ff8c00;
        border-radius: 5px;
        color: #fff;
        font-family: 'VT323', monospace;
        font-size: 1.2rem;
        transition: all 0.3s ease;
    }

    .url-input:focus {
        outline: none;
        box-shadow: 0 0 15px rgba(255,140,0,0.5);
    }

    .result-container {
        display: none;
        margin-top: 2rem;
        padding: 1rem;
        background: #1a1a1a;
        border: 2px solid #ff8c00;
        border-radius: 5px;
        text-align: center;
        transition: box-shadow 0.3s ease;
    }

    .result-container:hover {
        box-shadow: 0 0 15px #f97316;
    }

    .short-url {
        font-family: 'VT323', monospace;
        font-size: 1.5rem;
        color: #ff8c00;
        word-break: break-all;
        margin: 1rem 0;
    }

    .copy-button {
        background: #2a2a2a;
        border: 2px solid #ff8c00;
        color: #ff8c00;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        cursor: pointer;
        font-family: 'VT323', monospace;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .copy-button:hover {
        background: #ff8c00;
        color: #1a1a1a;
    }

    .error-message {
        display: none;
        color: #ff4444;
        margin-top: 1rem;
        font-family: 'VT323', monospace;
        font-size: 1.2rem;
    }

    .options-container {
        margin-top: 1rem;
        padding: 1rem;
        background: #1a1a1a;
        border: 2px solid #ff8c00;
        border-radius: 5px;
        transition: box-shadow 0.3s ease;
    }

    .options-container:hover {
        box-shadow: 0 0 15px #f97316;
    }

    .option-toggle {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        transition: all 0.2s ease;
        font-family: 'VT323', monospace;
        font-size: 1.2rem;
        color: #ff8c00;
        margin-bottom: 1rem;
        user-select: none;
    }

    .option-toggle:hover {
        background: rgba(255,140,0,0.1);
    }

    .option-toggle input[type="checkbox"] {
        appearance: none;
        width: 20px;
        height: 20px;
        border: 3px solid #fb8c00;
        background: #2a2a2a;
        cursor: pointer;
        margin-right: 10px;
        position: relative;
        transition: all 0.3s ease;
    }

    .option-toggle input[type="checkbox"]:checked {
        background: #f4511e;
        box-shadow: inset 0 0 0 3px #2a2a2a;
    }

    .option-toggle input[type="checkbox"]:hover {
        box-shadow: 0 0 10px #f4511e;
    }

    .option-toggle input[type="checkbox"]:checked:hover {
        box-shadow: inset 0 0 0 3px #2a2a2a, 0 0 10px #f4511e;
    }

    .option-input {
        display: none;
        margin-top: 1rem;
    }

    .expiry-select {
        background: #2a2a2a;
        border: 2px solid #ff8c00;
        color: #ff8c00;
        padding: 0.5rem;
        border-radius: 5px;
        font-family: 'VT323', monospace;
        font-size: 1.2rem;
        width: 100%;
        margin-top: 0.5rem;
    }

    .expiry-select option {
        background: #1a1a1a;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-4xl mb-8 text-center text-white font-vt323">URL Shortener</h1>
    
    <div class="url-form">
        <input type="url" id="long-url" class="url-input" placeholder="Enter your long URL here...">
        
        <div class="options-container">
            <label class="option-toggle">
                <input type="checkbox" id="custom-path-checkbox" class="mr-2">
                Use custom path
            </label>
            <div id="custom-path-input" class="option-input">
                <input type="text" id="custom-path" class="url-input" placeholder="Enter custom path (e.g., my-link)">
            </div>

            <label class="option-toggle">
                <input type="checkbox" id="expiry-checkbox" class="mr-2">
                Set expiration
            </label>
            <div id="expiry-input" class="option-input">
                <select id="expires-in-days" class="expiry-select">
                    <option value="">Never expires</option>
                    <option value="1">1 day</option>
                    <option value="7">7 days</option>
                    <option value="30">30 days</option>
                    <option value="90">90 days</option>
                    <option value="365">1 year</option>
                </select>
            </div>
        </div>

        <div class="text-center mt-6">
            <button onclick="shortenUrl()" class="retro-button">Shorten URL</button>
        </div>

        <div id="result" class="result-container">
            <h3 class="text-white text-xl mb-4">Your shortened URL:</h3>
            <div id="short-url" class="short-url"></div>
            <button onclick="copyToClipboard()" class="copy-button">Copy URL</button>
        </div>

        <div id="error" class="error-message"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('custom-path-checkbox').addEventListener('change', function() {
        const customPathInput = document.getElementById('custom-path-input');
        customPathInput.style.display = this.checked ? 'block' : 'none';
    });

    document.getElementById('expiry-checkbox').addEventListener('change', function() {
        const expiryInput = document.getElementById('expiry-input');
        expiryInput.style.display = this.checked ? 'block' : 'none';
        if (!this.checked) {
            document.getElementById('expires-in-days').value = '';
        }
    });

    async function shortenUrl() {
        const longUrl = document.getElementById('long-url').value;
        const customPathEnabled = document.getElementById('custom-path-checkbox').checked;
        const customPath = customPathEnabled ? document.getElementById('custom-path').value : null;
        const expiryEnabled = document.getElementById('expiry-checkbox').checked;
        const expiresInDays = expiryEnabled ? document.getElementById('expires-in-days').value : null;
        
        const resultContainer = document.getElementById('result');
        const errorContainer = document.getElementById('error');
        
        try {
            const response = await fetch('/api/shorten', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    url: longUrl,
                    custom_path: customPath,
                    expires_in_days: expiresInDays
                })
            });
            
            const data = await response.json();
            
            if (response.ok) {
                const shortUrl = `https://www.short.dohmboy64.com/${data.short_url}`;
                document.getElementById('short-url').textContent = shortUrl;
                resultContainer.style.display = 'block';
                errorContainer.style.display = 'none';
            } else {
                errorContainer.textContent = data.error || 'An error occurred';
                errorContainer.style.display = 'block';
                resultContainer.style.display = 'none';
            }
        } catch (error) {
            errorContainer.textContent = 'Network error occurred';
            errorContainer.style.display = 'block';
            resultContainer.style.display = 'none';
        }
    }

    async function copyToClipboard() {
        const shortUrl = document.getElementById('short-url').textContent;
        try {
            await navigator.clipboard.writeText(shortUrl);
            const copyButton = document.querySelector('.copy-button');
            copyButton.textContent = 'Copied!';
            setTimeout(() => {
                copyButton.textContent = 'Copy URL';
            }, 2000);
        } catch (err) {
            console.error('Failed to copy:', err);
        }
    }
</script>
{% endblock %} 